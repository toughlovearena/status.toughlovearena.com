{"version":3,"sources":["comp/shared.tsx","cron.ts","util.ts","comp/Poll.tsx","comp/StatusTable.tsx","comp/Version.tsx","comp/News.tsx","comp/ActivePlayers.tsx","chart.ts","queueTimes.ts","comp/RankedQueueTimes.tsx","comp/CasualQueueTimes.tsx","comp/App.tsx","reportWebVitals.ts","index.tsx"],"names":["MainContainer","styled","div","DataContainer","DataSection","SectionTitle","DataTable","table","CRON","PERIOD","callbacks","setInterval","step","this","Object","values","forEach","cb","key","undefined","unregister","fetchNoCache","url","fetch","Date","getTime","chunk","arr","chunkSize","results","start","length","push","slice","PollLink","a","props","isUp","Poll","label","report","useState","setIsUp","pingMs","setPingMs","checkIsUp","useCallback","before","performance","now","ok","Error","after","Math","round","useEffect","register","href","polls","StatusLabel","records","StatusTable","allUp","setAllUp","reportPoll","success","every","b","map","pd","pi","Version","version","setVersion","fetchVersion","response","json","data","v","News","news","setNews","fetchNews","message","newsCopy","dangerouslySetInnerHTML","__html","ActivePlayers","counts","setCounts","fetchCounts","total","reduce","c","sum","renderCount","ChartRef","args","chart","canvasElm","colorRGB","ctx","getContext","Chart","BarController","BarElement","CategoryScale","LinearScale","myChart","type","labels","datasets","backgroundColor","r","g","borderColor","borderWidth","options","plugins","legend","display","responsive","maintainAspectRatio","scales","x","title","text","color","ticks","y","beginAtZero","QUEUE_TIMES","casual","ranked","cr","queueTimes","console","log","lookup","latestDate","keys","sort","pop","queueDate","seconds","parseFloat","split","count","toString","dataSet","sumCount","average","allLabels","out","i","range","max","d","allValues","concat","curr","queues","servers","prod","filter","s","ref","q","graphData","convertQueueTimesToData","ds","lab","val","update","setAverage","RankedQueueTimes","canvasRef","useRef","current","registerRanked","CasualQueueTimes","registerCasual","Header","Logo","img","Footer","App","updated","setUpdated","src","alt","toLocaleTimeString","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","window","location","reload"],"mappings":"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","file":"static/js/main.341b4a69.chunk.js","sourcesContent":["import styled from 'styled-components';\n\nexport const MainContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n\n  padding: 2rem 1rem;\n  box-sizing: border-box;\n  max-width: 800px;\n\n  @media (min-width: 800px) {\n    max-width: 1200px;\n  }\n`;\n\nexport const DataContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n\n  @media (min-width: 800px) {\n    flex-direction: row;\n    justify-content: center;\n    align-items: flex-start;\n    flex-wrap: wrap;\n  }\n`;\n\nexport const DataSection = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  flex-wrap: nowrap;\n\n  @media (min-width: 800px) {\n    width: 500px;\n  }\n`;\n\nexport const SectionTitle = styled.div`\n  font-size: 1.5em;\n  margin: 1em 0;\n  margin-bottom: 0.5em;\n`;\n\nexport const DataTable = styled.table`\n  font-size: 1rem;\n  border-collapse: collapse;\n\n  th,\n  td {\n    text-align: center;\n    border: 1px solid grey;\n    padding: 0.5em 1em;\n    background-color: rgb(60, 60, 60);\n  }\n\n  th {\n    background-color: inherit;\n  }\n`;\n","interface IntervalCallback {\n  (): void;\n}\n\nclass CronSingleton {\n  private readonly PERIOD = 30 * 1000;\n  private readonly callbacks: Record<string, IntervalCallback | undefined> = {};\n  constructor() {\n    setInterval(() => this.step(), this.PERIOD);\n  }\n\n  private step() {\n    Object.values(this.callbacks).forEach(cb => cb && cb());\n  }\n\n  register(key: string, cb: IntervalCallback) {\n    const existing = this.callbacks[key];\n    if (existing !== undefined) {\n      // do nothing\n    } else {\n      cb();\n    }\n    this.callbacks[key] = cb;\n    return () => this.unregister(key);\n  }\n  private unregister(key: string) {\n    this.callbacks[key] = () => { };\n  }\n}\n\nexport const CRON = new CronSingleton();\n","\nexport function fetchNoCache(url: string) {\n  return fetch(url + '?cache=' + new Date().getTime());\n}\n\nexport function range(length: number): number[] {\n  const out = [] as number[];\n  for (let i = 0; i < length; i++) {\n    out.push(i);\n  }\n  return out;\n}\n\nexport function chunk<T>(arr: T[], chunkSize: number): T[][] {\n  const results = [];\n  let start = 0;\n  while (start < arr.length) {\n    results.push(arr.slice(start, start + chunkSize));\n    start += chunkSize;\n  }\n  return results;\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { CRON } from '../cron';\nimport { fetchNoCache } from '../util';\n\nconst PollLink = styled.a<{ isUp: boolean }>`\n  color: ${props => props.isUp ? 'lightgreen' : 'salmon'};\n  text-decoration: none;\n`;\n\nexport function Poll(props: {\n  label: string;\n  url: string;\n  report(ok: boolean): void;\n}) {\n  const {\n    label,\n    url,\n    report,\n  } = props;\n\n  const [isUp, setIsUp] = useState(undefined as boolean | undefined);\n  const [pingMs, setPingMs] = useState(undefined as number | undefined);\n\n  const checkIsUp = useCallback(async () => {\n    const before = performance.now();\n    try {\n      const response = await fetchNoCache(url);\n      if (!response.ok) {\n        throw new Error('fetch failed: ' + url);\n      }\n      setIsUp(true);\n      report(true);\n    } catch (err) {\n      setIsUp(false);\n      report(false);\n    }\n    const after = performance.now();\n    setPingMs(Math.round(after - before));\n  }, [url, report, setIsUp, setPingMs]);\n  useEffect(() => CRON.register(`poll-${label}`, () => checkIsUp()), [label, checkIsUp]);\n\n  return (\n    <tr>\n      <td>{label}</td>\n      <td>\n        {isUp === undefined ? '???' : (\n          <PollLink href={url} isUp={isUp}>\n            {isUp ? 'OK' : 'DOWN'}\n          </PollLink>\n        )}\n      </td>\n      <td>\n        {pingMs ?? '???'}\n      </td>\n    </tr>\n  );\n}\n","import React, { useCallback, useState } from 'react';\nimport { Poll } from './Poll';\nimport styled from 'styled-components';\nimport { DataSection, DataTable, SectionTitle } from './shared';\n\nconst polls = [{\n  label: 'toughlovearena.com',\n  url: 'https://toughlovearena.com/version.json',\n}, {\n  label: 'cache.tla',\n  url: 'https://cache.toughlovearena.com/health',\n}, {\n  label: 'handshake.tla',\n  url: 'https://handshake.toughlovearena.com/health',\n}, {\n  label: 'leaderboard.tla',\n  url: 'https://leaderboard.toughlovearena.com/health',\n}, {\n  label: 'match.tla',\n  url: 'https://match.toughlovearena.com',\n}, {\n  label: 'presence.tla',\n  url: 'https://presence.toughlovearena.com/health',\n}, {\n  label: 'stun.tla',\n  url: 'https://stun.toughlovearena.com/health',\n}, {\n  label: 'serverless accounts API\t',\n  url: 'https://us-central1-fighter-api.cloudfunctions.net/webApi/api/v1/',\n}];\n\nconst StatusLabel = styled.a<{ isUp: boolean }>`\n  color: ${props => props.isUp ? 'lightgreen' : 'salmon'};\n`;\n\n// todo not sure where to put this w/ hooks\nconst records: Record<string, boolean> = {};\n\nexport function StatusTable() {\n  const [allUp, setAllUp] = useState(undefined as boolean | undefined);\n\n  const reportPoll = useCallback((url: string, success: boolean) => {\n    records[url] = success;\n    setAllUp(Object.values(records).every(b => b));\n  }, [setAllUp]);\n\n  return (\n    <DataSection>\n      <SectionTitle>\n        Status: {allUp === undefined ? '???' : (\n          <StatusLabel isUp={allUp}>\n            {allUp ? 'OK' : 'DOWN'}\n          </StatusLabel>\n        )}\n      </SectionTitle>\n      <DataTable>\n        <thead>\n          <tr>\n            <th>Service</th>\n            <th>Status</th>\n            <th>ms</th>\n          </tr>\n        </thead>\n        <tbody>\n          {polls.map((pd, pi) => (\n            <Poll\n              key={pi}\n              report={ok => reportPoll(pd.url, ok)}\n              {...pd}\n            />\n          ))}\n        </tbody>\n      </DataTable>\n    </DataSection>\n  )\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { CRON } from '../cron';\nimport { fetchNoCache } from '../util';\n\nexport function Version() {\n  const [version, setVersion] = useState(undefined as string | undefined);\n\n  const fetchVersion = useCallback(async () => {\n    const response = await fetchNoCache('https://toughlovearena.com/version.json');\n    const data = await response.json() as { v: string, u: string, };\n    setVersion(data.v);\n  }, [setVersion]);\n  useEffect(() => CRON.register('version', () => fetchVersion()), [fetchVersion]);\n\n  return (\n    <div>\n      <a href='https://toughlovearena.com?changelog'>\n        v{version ?? '???'}\n      </a>\n    </div>\n  );\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { CRON } from '../cron';\nimport { fetchNoCache } from '../util';\n\nexport function News() {\n  const [news, setNews] = useState(undefined as string | undefined);\n\n  const fetchNews = useCallback(async () => {\n    const response = await fetchNoCache('https://us-central1-fighter-api.cloudfunctions.net/webApi/api/v1/news');\n    const data = await response.json() as { message: string, };\n    setNews(data.message);\n  }, [setNews]);\n  useEffect(() => CRON.register('news', () => fetchNews()), [fetchNews]);\n\n  const newsCopy = (\n    (news === undefined && '???') ||\n    news ||\n    '<i>no news</i>'\n  );\n  return (\n    <div>\n      News: <span dangerouslySetInnerHTML={{ __html: newsCopy, }} />\n    </div>\n  );\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { CRON } from '../cron';\nimport { DataSection, SectionTitle, DataTable } from './shared';\nimport { fetchNoCache } from '../util';\n\nexport function ActivePlayers() {\n  const [counts, setCounts] = useState(undefined as Record<string, number> | undefined);\n\n  const fetchCounts = useCallback(async () => {\n    const response = await fetchNoCache('https://presence.toughlovearena.com');\n    const counts = await response.json() as Record<string, number>;\n    setCounts(counts);\n  }, [setCounts]);\n  useEffect(() => CRON.register('activePlayers', () => fetchCounts()), [fetchCounts]);\n\n  const total = counts ? Object.values(counts).reduce((c, sum) => sum + c, 0) : '???';\n  const renderCount = (key: string) => (counts && counts[key]) ?? '?';\n\n  return (\n    <DataSection>\n      <SectionTitle>\n        Active Players: {total}\n      </SectionTitle>\n      <DataTable>\n        <thead>\n          <tr>\n            <th>Game Mode</th>\n            <th>#</th>\n            <th>Game Mode</th>\n            <th>#</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>Welcome</td>\n            <td>{renderCount('welcome')}</td>\n            <td>Ranked Match</td>\n            <td>{renderCount('online_ranked')}</td>\n          </tr>\n          <tr>\n            <td>Tutorial</td>\n            <td>{renderCount('tutorial')}</td>\n            <td>Casual Match</td>\n            <td>{renderCount('online_casual')}</td>\n          </tr>\n          <tr>\n            <td>Local Versus</td>\n            <td>{renderCount('local')}</td>\n            <td>Private Match</td>\n            <td>{renderCount('online_private')}</td>\n          </tr>\n          <tr>\n            <td>Versus CPU</td>\n            <td>{renderCount('cpu')}</td>\n            <td>Private Lobby</td>\n            <td>{renderCount('online_lobby')}</td>\n          </tr>\n          <tr>\n            <td>Training</td>\n            <td>{renderCount('training')}</td>\n            <td>Modding</td>\n            <td>{renderCount('modding')}</td>\n          </tr>\n        </tbody>\n      </DataTable>\n    </DataSection>\n  );\n}\n","import { BarController, BarElement, CategoryScale, Chart, ChartType, LinearScale } from 'chart.js';\n\nexport class ChartRef {\n  readonly chart: Chart;\n  constructor(args: {\n    canvasElm: HTMLCanvasElement;\n    label: string;\n    colorRGB: { r: number, g: number, b: number },\n  }) {\n    const {\n      canvasElm,\n      label,\n      colorRGB,\n    } = args;\n    const ctx = canvasElm.getContext('2d')!;\n    Chart.register(BarController, BarElement, CategoryScale, LinearScale);\n    const myChart = new Chart(ctx, {\n      type: 'bar' as ChartType,\n      data: {\n        labels: [],\n        datasets: [{\n          label: label,\n          data: [],\n          backgroundColor: `rgba(${colorRGB.r}, ${colorRGB.g}, ${colorRGB.b}, 0.2)`,\n          borderColor: `rgba(${colorRGB.r}, ${colorRGB.g}, ${colorRGB.b}, 1)`,\n          borderWidth: 1\n        }]\n      },\n      options: {\n        plugins: {\n          legend: {\n            display: false,\n          },\n        },\n        responsive: true,\n        maintainAspectRatio: true,\n        scales: {\n          x: {\n            title: {\n              display: true,\n              text: 'seconds waiting for match',\n              color: 'white',\n            },\n            ticks: {\n              color: 'white',\n            },\n          },\n          y: {\n            beginAtZero: true,\n            title: {\n              display: true,\n              text: 'matches',\n              color: 'white',\n            },\n            ticks: {\n              color: 'white',\n            },\n          },\n        },\n      }\n    });\n    this.chart = myChart;\n  }\n}\n","import { ChartRef } from './chart';\nimport { CRON } from './cron';\nimport { chunk, fetchNoCache, range } from './util';\n\ntype QueueTimes = Record<string, Record<string, number>>;\ntype QueueData = {\n  counter: number;\n  searching: string[];\n  queueTimes: QueueTimes;\n}\ntype ServerData = {\n  label: string;\n  path: string;\n  casual: QueueData;\n  ranked: QueueData;\n}\ntype QueueRef = {\n  chart: ChartRef;\n  setAverage(average: number | undefined): void;\n}\n\nclass QueueTimesSingleton {\n  private casual: QueueRef | undefined;\n  private ranked: QueueRef | undefined;\n  constructor() {\n    CRON.register('chart', () => this.step());\n  }\n\n  registerCasual(cr: QueueRef) {\n    this.casual = cr;\n    this.step();\n  }\n  registerRanked(cr: QueueRef) {\n    this.ranked = cr;\n    this.step();\n  }\n\n  private convertQueueTimesToData(queueTimes: QueueTimes) {\n    console.log(queueTimes);\n    const lookup: Record<string, number> = {};\n    const latestDate = Object.keys(queueTimes).sort().pop();\n    if (!latestDate) { return; }\n\n    const queueDate = queueTimes[latestDate];\n    for (const key in queueDate) {\n      const seconds = parseFloat(key.split('s')[0]);\n      const count = queueDate[key];\n      lookup[seconds.toString()] = (lookup[seconds.toString()] || 0) + count;\n    }\n    const dataSet = [];\n    let sum = 0;\n    let sumCount = 0;\n    for (const key in lookup) {\n      const seconds = parseFloat(key);\n      const count = lookup[key];\n      dataSet.push({ seconds, count, });\n      sum += seconds * count;\n      sumCount += count;\n    }\n    const average = sum / sumCount;\n    const highest = Math.max(...dataSet.map(d => d.seconds));\n    const allLabels = range(highest + 1);\n    const allValues = allLabels.map(i => lookup[i.toString()] || 0);\n    const labels = chunk(allLabels, 5).map(c => `${c[0]} - ${c.concat().pop()}`);\n    const values = chunk(allValues, 5).map(c => c.reduce((sum, curr) => sum + curr, 0));\n    return { labels, values, average };\n  }\n  private async step() {\n    const queues: { queueTimes: QueueTimes, ref: QueueRef }[] = [];\n    try {\n      const response = await fetchNoCache('https://match.toughlovearena.com/details');\n      const servers = await response.json() as ServerData[];\n      const prod = servers.filter(s => s.label === 'prod')[0];\n      if (this.casual) {\n        queues.push({\n          queueTimes: prod.casual.queueTimes,\n          ref: this.casual,\n        });\n      }\n      if (this.ranked) {\n        queues.push({\n          queueTimes: prod.ranked.queueTimes,\n          ref: this.ranked,\n        });\n      }\n      queues.forEach(q => {\n        const graphData = this.convertQueueTimesToData(q.queueTimes);\n        if (!graphData) { return; }\n\n        while (q.ref.chart.chart.data.labels?.length) {\n          q.ref.chart.chart.data.labels.pop();\n        }\n        q.ref.chart.chart.data.datasets.forEach(ds => {\n          while (ds.data.length) {\n            ds.data.pop();\n          }\n        });\n        graphData.labels.forEach(lab => q.ref.chart.chart.data.labels!.push(lab));\n        graphData.values.forEach(val => q.ref.chart.chart.data.datasets.forEach(ds => ds.data.push(val)));\n        q.ref.chart.chart.update();\n        q.ref.setAverage(Math.round(graphData.average));\n      });\n    } catch (err) {\n      console.log(err);\n      queues.forEach(q => {\n        q.ref.setAverage(undefined);\n      });\n    }\n  }\n}\n\nexport const QUEUE_TIMES = new QueueTimesSingleton();\n","import React, { useEffect, useRef, useState } from 'react';\nimport { ChartRef } from '../chart';\nimport { QUEUE_TIMES } from '../queueTimes';\nimport { DataSection, SectionTitle } from './shared';\n\nexport function RankedQueueTimes() {\n  const canvasRef = useRef(null as HTMLCanvasElement | null);\n  const [average, setAverage] = useState(undefined as number | undefined);\n\n  useEffect(() => {\n    if (canvasRef.current) {\n      const chart = new ChartRef({\n        canvasElm: canvasRef.current,\n        label: 'Ranked Queue Time',\n        colorRGB: { r: 162, g: 100, b: 235, },\n      });\n      QUEUE_TIMES.registerRanked({ chart, setAverage });\n    }\n  }, [canvasRef, setAverage]);\n\n  return (\n    <DataSection>\n      <SectionTitle>\n        Ranked Queue Time: {average ?? '???'} seconds\n      </SectionTitle>\n      <canvas ref={canvasRef} />\n    </DataSection>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport { ChartRef } from '../chart';\nimport { QUEUE_TIMES } from '../queueTimes';\nimport { DataSection, SectionTitle } from './shared';\n\nexport function CasualQueueTimes() {\n  const canvasRef = useRef(null as HTMLCanvasElement | null);\n  const [average, setAverage] = useState(undefined as number | undefined);\n\n  useEffect(() => {\n    if (canvasRef.current) {\n      const chart = new ChartRef({\n        canvasElm: canvasRef.current,\n        label: 'Casual Queue Time',\n        colorRGB: { r: 54, g: 162, b: 235, },\n      });\n      QUEUE_TIMES.registerCasual({ chart, setAverage });\n    }\n  }, [canvasRef, setAverage]);\n\n  return (\n    <DataSection>\n      <SectionTitle>\n        Casual Queue Time: {average ?? '???'} seconds\n      </SectionTitle>\n      <canvas ref={canvasRef} />\n    </DataSection>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { MainContainer, DataContainer } from './shared';\nimport { StatusTable } from './StatusTable';\nimport { Version } from './Version';\nimport { News } from './News';\nimport { ActivePlayers } from './ActivePlayers';\nimport { RankedQueueTimes } from './RankedQueueTimes';\nimport { CasualQueueTimes } from './CasualQueueTimes';\nimport { CRON } from '../cron';\n\nconst Header = styled.div`\n  padding-bottom: 0.5rem;\n  border-bottom: 1px solid white;\n`;\nconst Logo = styled.img`\n  display: block;\n  width: 100%;\n  max-width: 600px;\n  height: auto;\n`;\nconst Footer = styled.div`\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid white;\n`;\n\nexport function App() {\n  const [updated, setUpdated] = useState(undefined as Date | undefined);\n  useEffect(() => CRON.register('updated', () => setUpdated(new Date())), [setUpdated]);\n\n  return (\n    <MainContainer>\n      <Header>\n        <Logo src=\"logo.png\" alt=\"logo\" />\n        <div>Tough Love Arena Status Page</div>\n        <Version />\n        <News />\n      </Header>\n\n      <DataContainer>\n        <StatusTable />\n        <ActivePlayers />\n        <RankedQueueTimes />\n        <CasualQueueTimes />\n      </DataContainer>\n\n      <Footer>\n        Updates every 30 seconds\n        <br />\n        Last updated @ {updated?.toLocaleTimeString() ?? '???'}\n        <br />\n        If anything is down, please email <a href=\"mailto:toughlovearena@gmail.com\">toughlovearena@gmail.com</a>\n      </Footer>\n    </MainContainer>\n  );\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './comp';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// hard refresh every 5 mins\nsetInterval(() => window.location.reload(false), 5 * 60 * 1000);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}